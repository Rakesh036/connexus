<% layout("layouts/boilerplate") %>

<h1>All Groups</h1>

<ul class="list-group">
    <a href="/groups/new" class="btn btn-success mb-3">Create New Group</a>
    <% groups.forEach(group => { %>
    <li class="list-group-item group-item">
        <a href="/groups/<%= group._id %>"><%= group.title %></a>
        <div class="btn-group">
            <!-- Compare as strings to avoid issues with Mongoose ObjectId comparison -->
            <% if (!group.members.some((member) => String(member._id) === String(currUserT))) { %>
            <form action="/groups/<%= group._id %>/join" method="POST">
                <button type="submit" class="btn btn-primary">Join</button>
            </form>
            <% } %>
            <a href="/groups/<%= group._id %>" class="btn btn-secondary">View</a>
        </div>
    </li>
    <% }) %>
</ul>